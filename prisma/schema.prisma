generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Profile {
  id             String   @id @default(uuid()) @db.Uuid
  full_name      String?
  avatar_url     String?
  email          String   @unique
  secret_message String?
  updated_at     DateTime @updatedAt
  created_at     DateTime @default(now())

  friendships_as_requester Friendship[] @relation("FriendshipRequester")
  friendships_as_receiver  Friendship[] @relation("FriendshipReceiver")
  todos                    Todo[]
  photos                   Photo[]
  foodPhotos               FoodPhoto[]
  reviews                  Review[]

  @@map("profile")
}

model Friendship {
  id           String   @id @default(uuid()) @db.Uuid
  requester_id String   @db.Uuid
  receiver_id  String   @db.Uuid
  status       String   @default("pending") // pending, accepted, rejected
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  requester Profile @relation("FriendshipRequester", fields: [requester_id], references: [id], onDelete: Cascade)
  receiver  Profile @relation("FriendshipReceiver", fields: [receiver_id], references: [id], onDelete: Cascade)

  @@unique([requester_id, receiver_id])
  @@map("friendship")
}

model Todo {
  id         String   @id @default(uuid()) @db.Uuid
  profileId  String   @map("profile_id") @db.Uuid
  title      String
  completed  Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([created_at])
  @@map("todos")
}

model Photo {
  id         String   @id @default(uuid()) @db.Uuid
  profileId  String   @map("profile_id") @db.Uuid
  name       String
  url        String
  size       Int? // File size in bytes
  mime_type  String?  @map("mime_type")
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([created_at])
  @@index([name])
  @@map("photos")
}

model FoodPhoto {
  id         String   @id @default(uuid()) @db.Uuid
  profileId  String   @map("profile_id") @db.Uuid
  name       String
  url        String
  size       Int? // File size in bytes
  mime_type  String?  @map("mime_type")
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)

  profile Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  reviews Review[]

  @@index([profileId])
  @@index([created_at])
  @@index([name])
  @@map("food_photos")
}

model Review {
  id          String   @id @default(uuid()) @db.Uuid
  foodPhotoId String   @map("food_photo_id") @db.Uuid
  profileId   String   @map("profile_id") @db.Uuid
  rating      Int // 1-5 stars
  comment     String? // Optional review text
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)

  foodPhoto FoodPhoto @relation(fields: [foodPhotoId], references: [id], onDelete: Cascade)
  profile   Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([foodPhotoId])
  @@index([profileId])
  @@index([created_at])
  @@map("reviews")
}
